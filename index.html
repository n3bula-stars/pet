<script>
let chaosStarted = false;
let intervals = [];
let popups = [];
let oscillator, audioCtx;
let chaosLevel = 1;

document.body.addEventListener("click", () => {
  if (chaosStarted) return;
  chaosStarted = true;
  document.querySelector("h1").textContent =
    "SYSTEM COMPROMISED — PRESS ESC";

  startColorStrobe();
  startExtremeShake();
  startGlitchAudio();
  startPopupExplosion();
  startScreenInvert();
  startScrollHijack();
  startCrashFlashes();
});

document.addEventListener("keydown", e => {
  if (e.key === "Escape") stopChaos();
});

function addInterval(fn, time) {
  const id = setInterval(fn, time);
  intervals.push(id);
}

function stopChaos() {
  intervals.forEach(clearInterval);
  intervals = [];
  popups.forEach(p => p.remove());
  popups = [];
  if (oscillator) oscillator.stop();
  if (audioCtx) audioCtx.close();
  document.body.style = "";
  document.body.innerHTML =
    "<h1 style='color:white;text-align:center;margin-top:40vh'>Chaos Stopped</h1>";
  chaosStarted = false;
}

/* ===========================
   EXTREME STROBE
=========================== */

function startColorStrobe() {
  addInterval(() => {
    document.body.style.background =
      `hsl(${Math.random()*360},100%,50%)`;
  }, 30);
}

/* ===========================
   SCREEN SHAKE
=========================== */

function startExtremeShake() {
  addInterval(() => {
    document.body.style.transform =
      `translate(${Math.random()*60-30}px,
                 ${Math.random()*60-30}px)
       rotate(${Math.random()*20-10}deg)`;
  }, 20);
}

/* ===========================
   GLITCH AUDIO
=========================== */

function startGlitchAudio() {
  audioCtx = new (window.AudioContext ||
                  window.webkitAudioContext)();

  oscillator = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  oscillator.type = "sawtooth";
  oscillator.connect(gain);
  gain.connect(audioCtx.destination);
  gain.gain.value = 0.1;
  oscillator.start();

  addInterval(() => {
    oscillator.frequency.value =
      50 + Math.random()*2000;
  }, 50);
}

/* ===========================
   EXPONENTIAL POPUPS
=========================== */

function startPopupExplosion() {
  addInterval(() => {
    for (let i=0; i<chaosLevel; i++) createPopup();
    chaosLevel += 0.2;
  }, 500);

  addInterval(movePopups, 20);
}

function createPopup() {
  const div = document.createElement("div");
  div.style.position = "fixed";
  div.style.width = "220px";
  div.style.height = "120px";
  div.style.background = "white";
  div.style.color = "black";
  div.style.padding = "10px";
  div.style.fontWeight = "bold";
  div.style.boxShadow = "0 0 30px red";
  div.innerHTML =
    "⚠ SYSTEM BREACH<br>Tracking IP...";

  div.style.left =
    Math.random()*(window.innerWidth-220)+"px";
  div.style.top =
    Math.random()*(window.innerHeight-120)+"px";

  div.vx = (Math.random()-0.5)*20;
  div.vy = (Math.random()-0.5)*20;

  document.body.appendChild(div);
  popups.push(div);

  if (Math.random() < 0.3)
    setTimeout(createPopup, 200);
}

function movePopups() {
  popups.forEach(div => {
    let x = div.offsetLeft + div.vx;
    let y = div.offsetTop + div.vy;

    if (x <= 0 || x+220 >= window.innerWidth)
      div.vx *= -1;
    if (y <= 0 || y+120 >= window.innerHeight)
      div.vy *= -1;

    div.style.left = x+"px";
    div.style.top = y+"px";
  });
}

/* ===========================
   SCREEN INVERT GLITCH
=========================== */

function startScreenInvert() {
  addInterval(() => {
    if (Math.random() < 0.3)
      document.body.style.filter =
        "invert(1) contrast(3)";
    else
      document.body.style.filter = "none";
  }, 100);
}

/* ===========================
   SCROLL HIJACK
=========================== */

function startScrollHijack() {
  addInterval(() => {
    window.scrollTo(
      Math.random()*document.body.scrollWidth,
      Math.random()*document.body.scrollHeight
    );
  }, 200);
}

/* ===========================
   FAKE CRASH FLASH
=========================== */

function startCrashFlashes() {
  addInterval(() => {
    if (Math.random() < 0.1) {
      const overlay =
        document.createElement("div");
      overlay.style.position="fixed";
      overlay.style.inset="0";
      overlay.style.background="blue";
      overlay.style.color="white";
      overlay.style.display="flex";
      overlay.style.alignItems="center";
      overlay.style.justifyContent="center";
      overlay.style.fontSize="30px";
      overlay.innerText =
        "A problem has been detected...";

      document.body.appendChild(overlay);
      setTimeout(()=>overlay.remove(),500);
    }
  }, 1000);
}
</script>
