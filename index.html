<script>
let chaosStarted = false;
let intervals = [];
let oscillator = null;
let audioCtx = null;

document.body.addEventListener("click", () => {
  if (chaosStarted) return;
  chaosStarted = true;

  document.querySelector("h1").textContent =
    "CHAOS ACTIVE (Press ESC to stop)";

  startColorChaos();
  startFloatingText();
  startShaking();
  startAudioChaos();
  startThemeColorChaos();
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") stopChaos();
});

function addInterval(fn, time) {
  const id = setInterval(fn, time);
  intervals.push(id);
}

function stopChaos() {
  intervals.forEach(clearInterval);
  intervals = [];

  if (oscillator) oscillator.stop();
  if (audioCtx) audioCtx.close();

  document.body.style.background = "black";
  document.body.style.transform = "none";
  document.querySelector("h1").textContent =
    "Chaos Stopped (Click to restart)";
  chaosStarted = false;
}

function startColorChaos() {
  addInterval(() => {
    document.body.style.background =
      `hsl(${Math.random() * 360}, 100%, 50%)`;
  }, 100);
}

function startFloatingText() {
  const phrases = ["CHAOS", "ERROR", "SYSTEM OVERLOAD"];

  addInterval(() => {
    const div = document.createElement("div");
    div.className = "floating";
    div.textContent =
      phrases[Math.floor(Math.random() * phrases.length)];

    div.style.left = Math.random() * window.innerWidth + "px";
    div.style.top = Math.random() * window.innerHeight + "px";
    div.style.color =
      `hsl(${Math.random() * 360}, 100%, 50%)`;

    document.body.appendChild(div);
    setTimeout(() => div.remove(), 2000);
  }, 150);
}

function startShaking() {
  addInterval(() => {
    document.body.style.transform =
      `translate(${Math.random()*20-10}px,
                 ${Math.random()*20-10}px)
       rotate(${Math.random()*4-2}deg)`;
  }, 50);
}

function startAudioChaos() {
  audioCtx = new (window.AudioContext ||
                  window.webkitAudioContext)();

  oscillator = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  oscillator.type = "square";
  oscillator.frequency.value = 200;

  oscillator.connect(gain);
  gain.connect(audioCtx.destination);

  gain.gain.value = 0.05;
  oscillator.start();

  addInterval(() => {
    oscillator.frequency.value =
      100 + Math.random() * 1000;
  }, 200);
}

function startThemeColorChaos() {
  const meta =
    document.querySelector('meta[name="theme-color"]');

  addInterval(() => {
    meta.setAttribute(
      "content",
      `#${Math.floor(Math.random()*16777215)
        .toString(16)}`
    );
  }, 100);
}
</script>
